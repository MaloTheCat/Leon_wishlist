<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h2 class="text-center mb-4">Créer un compte</h2>
      
      <%= form_with model: @user, url: signup_path, local: true do |f| %>
        <% if @user.errors.any? %>
          <div class="alert alert-danger">
            <h4><%= pluralize(@user.errors.count, "erreur") %> empêche l'enregistrement :</h4>
            <ul>
              <% @user.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="row">
          <div class="col-md-6 mb-3">
            <%= f.label :first_name, "Prénom", class: "form-label" %>
            <%= f.text_field :first_name, class: "form-control", required: true %>
          </div>

          <div class="col-md-6 mb-3">
            <%= f.label :last_name, "Nom", class: "form-label" %>
            <%= f.text_field :last_name, class: "form-control", required: true %>
          </div>
        </div>

        <div class="mb-3">
          <%= f.label :email, "Email", class: "form-label" %>
          <%= f.email_field :email, class: "form-control", required: true %>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <%= f.label :password, "Mot de passe", class: "form-label" %>
            <%= f.password_field :password, class: "form-control", required: true, minlength: 6 %>
            <small class="text-muted">Minimum 6 caractères</small>
          </div>

          <div class="col-md-6 mb-3">
            <%= f.label :password_confirmation, "Confirmation", class: "form-label" %>
            <%= f.password_field :password_confirmation, class: "form-control", required: true %>
          </div>
        </div>

        <hr class="my-4">

        <h4 class="mb-3">Famille</h4>

        <div class="mb-3">
          <div class="form-check">
            <%= radio_button_tag :family_option, "new", true, class: "form-check-input" %>
            <%= label_tag :family_option_new, "Créer une nouvelle famille", class: "form-check-label" %>
          </div>
          <div id="new-family-field" class="mt-2">
            <%= label_tag :family_name, "Nom de la famille", class: "form-label" %>
            <%= text_field_tag :family_name, "", class: "form-control", placeholder: "Ex: Famille Dupont" %>
          </div>
        </div>

        <div class="mb-3">
          <div class="form-check">
            <%= radio_button_tag :family_option, "join", false, class: "form-check-input" %>
            <%= label_tag :family_option_join, "Rejoindre une famille existante", class: "form-check-label" %>
          </div>
          <div id="join-family-field" class="mt-2" style="display: none;">
            <%= label_tag :invite_code, "Code d'invitation", class: "form-label" %>
            <%= text_field_tag :invite_code, "", class: "form-control", placeholder: "Ex: ABC12345" %>
          </div>
        </div>

        <div class="d-grid">
          <%= f.submit "Créer mon compte", class: "btn btn-primary btn-lg" %>
        </div>
      <% end %>

      <div class="text-center mt-3">
        <p>Déjà un compte ? <%= link_to "Se connecter", login_path %></p>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="family_option"]');
    const newFamilyField = document.getElementById('new-family-field');
    const joinFamilyField = document.getElementById('join-family-field');

    radioButtons.forEach(radio => {
      radio.addEventListener('change', function() {
        if (this.value === 'new') {
          newFamilyField.style.display = 'block';
          joinFamilyField.style.display = 'none';
        } else {
          newFamilyField.style.display = 'none';
          joinFamilyField.style.display = 'block';
        }
      });
    });
  });
</script>
